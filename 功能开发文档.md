# 黄金投资应用第一阶段功能开发文档

## 项目概述

基于现有的黄金新闻爬虫数据，开发智能投资分析应用，第一阶段实现三大核心功能：
1. 新闻情感分析功能
2. 基础数据可视化
3. 简单的投资建议

## 技术架构

### 核心技术栈
- **大模型API**: 混元-lite (通过api.py提供的接口)
- **Web框架**: Streamlit
- **数据处理**: pandas, numpy
- **可视化**: plotly, matplotlib
- **配置管理**: python-dotenv

### 项目结构
```
investment_app/
├── api.py                    # 大模型API调用接口
├── data_capture.py          # 新闻爬虫(已存在)
├── sentiment_analyzer.py    # 情感分析模块
├── data_visualizer.py       # 数据可视化模块
├── investment_advisor.py    # 投资建议引擎
├── streamlit_app.py         # Web应用主界面
├── config.py               # 配置管理
├── utils.py                # 工具函数
├── requirements.txt        # 依赖包
├── .env                    # 环境变量
├── data/                   # 数据目录
├── cache/                  # 缓存目录
├── logs/                   # 日志目录
└── output/                 # 输出目录
```

## 功能模块详细设计

### 1. 新闻情感分析功能 (sentiment_analyzer.py)

#### 功能描述
- 调用大模型API分析新闻标题和内容的情感倾向
- 输出情感极性（正面/负面/中性）和强度分值（-1到1）
- 支持批量处理和缓存机制

#### 核心类设计
```python
class SentimentAnalyzer:
    def __init__(self):
        # 初始化API客户端和缓存
        pass
    
    def analyze_single_news(self, title, content):
        # 分析单条新闻情感
        pass
    
    def analyze_batch_news(self, news_list):
        # 批量分析新闻情感
        pass
    
    def get_sentiment_prompt(self, title, content):
        # 构建情感分析提示词
        pass
    
    def parse_sentiment_response(self, response):
        # 解析大模型返回结果
        pass
```

#### 输入输出格式
**输入**: 
- title: 新闻标题
- content: 新闻内容

**输出**:
```json
{
    "sentiment": "positive/negative/neutral",
    "score": 0.75,  # -1到1之间的分值
    "confidence": 0.85,  # 置信度
    "keywords": ["黄金", "上涨", "利好"],  # 关键词
    "reasoning": "新闻提到黄金价格上涨，市场情绪乐观"
}
```

### 2. 数据可视化功能 (data_visualizer.py)

**状态**: ✅ 已完成

**功能描述**: 提供丰富的数据可视化组件，支持多种图表类型和交互式分析。

**核心类**: `DataVisualizer`

**主要方法**:
- `plot_sentiment_timeline()`: 情感时间线散点图 ✅
- `plot_sentiment_distribution()`: 情感分布饼图 ✅
- `plot_news_volume()`: 新闻数量统计柱状图 ✅
- `plot_sentiment_heatmap()`: 情感热力图/按日期分组图 ✅
- `plot_confidence_distribution()`: 置信度分布直方图 ✅
- `plot_score_vs_confidence()`: 分值与置信度关系散点图 ✅
- `generate_wordcloud()`: 关键词云图 ✅
- `create_summary_metrics()`: 生成汇总统计指标 ✅

**技术特点**:
- 使用 Plotly 创建交互式图表
- 支持多种可视化类型（饼图、散点图、柱状图、热力图、直方图）
- 集成 WordCloud 生成关键词云
- 响应式设计，适配不同屏幕尺寸
- 支持数据过滤和动态更新
- 智能错误处理和数据格式兼容
- 中英文标签支持

**已集成功能**:
- ✅ 核心指标展示（总数、平均分值、置信度、市场情绪）
- ✅ 情感分布可视化
- ✅ 时间序列分析
- ✅ 新闻数量趋势
- ✅ 置信度分析
- ✅ 情感热力图/日期分组
- ✅ 关键词云图（支持情感过滤）
- ✅ 分值置信度关系分析

### 3. 投资建议功能 (investment_advisor.py)

#### 功能描述
- 基于情感分析结果生成投资建议
- 风险评估和预警
- 市场情绪指标计算

#### 建议逻辑
- **强烈看涨** (score > 0.6): 建议关注买入机会
- **温和看涨** (0.2 < score <= 0.6): 建议谨慎乐观
- **中性观望** (-0.2 <= score <= 0.2): 建议观望等待
- **温和看跌** (-0.6 <= score < -0.2): 建议谨慎操作
- **强烈看跌** (score < -0.6): 建议考虑减仓

### 4. Web应用界面 (streamlit_app.py)

#### 页面结构
1. **首页**: 概览和最新分析结果
2. **情感分析**: 新闻情感分析详情
3. **数据可视化**: 各类图表展示
4. **投资建议**: 基于分析的投资建议
5. **设置**: 参数配置和数据管理

## 开发计划

### 第一步: 新闻情感分析功能
1. 创建sentiment_analyzer.py模块
2. 实现API调用和提示词工程
3. 添加缓存和错误处理机制
4. 编写单元测试

### 第二步: 数据可视化功能
1. 创建data_visualizer.py模块
2. 实现各类图表生成函数
3. 集成到Streamlit界面

### 第三步: 投资建议功能
1. 创建investment_advisor.py模块
2. 实现建议生成逻辑
3. 添加风险提示机制

### 第四步: 整合和优化
1. 创建主应用界面
2. 性能优化和用户体验改进
3. 部署和测试

## 技术要点

### 提示词工程
针对金融新闻的情感分析，需要设计专业的提示词：
```
你是一个专业的金融分析师，请分析以下黄金相关新闻的情感倾向：

标题：{title}
内容：{content}

请从以下维度分析：
1. 对黄金价格的影响倾向（正面/负面/中性）
2. 情感强度（-1到1的数值，-1最负面，1最正面）
3. 关键影响因素
4. 置信度评估

请以JSON格式返回结果。
```

### 缓存策略
- 使用文件缓存避免重复分析相同新闻
- 缓存键：新闻URL的MD5哈希值
- 缓存有效期：7天

### 错误处理
- API调用失败重试机制
- 网络超时处理
- 数据格式验证
- 日志记录和监控

## 性能指标

- **响应时间**: 单条新闻分析 < 3秒
- **准确率**: 情感分析准确率 > 80%
- **并发处理**: 支持10条新闻并发分析
- **缓存命中率**: > 60%

## 安全考虑

- API密钥安全存储
- 输入数据验证和清洗
- 输出结果安全过滤
- 访问频率限制

---

*本文档将随着开发进度持续更新*